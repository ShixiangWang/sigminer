<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract Signatures through the Automatic Relevance Determination Technique — sig_auto_extract • sigminer</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract Signatures through the Automatic Relevance Determination Technique — sig_auto_extract" />
<meta property="og:description" content="A bayesian variant of NMF algorithm to enable optimal inferences for the
number of signatures through the automatic relevance determination technique.
This functions delevers highly interpretable and sparse representations for
both signature profiles and attributions at a balance between data fitting and
model complexity (this method may introduce more signatures than expected,
especially for copy number signatures (thus I don't recommend you to use this feature
to extract copy number signatures)). See detail part and references for more." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sigminer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/sigminer.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ShixiangWang/sigminer/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract Signatures through the Automatic Relevance Determination Technique</h1>
    <small class="dont-index">Source: <a href='https://github.com/ShixiangWang/sigminer/blob/master/R/sig_auto_extract.R'><code>R/sig_auto_extract.R</code></a></small>
    <div class="hidden name"><code>sig_auto_extract.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A bayesian variant of NMF algorithm to enable optimal inferences for the
number of signatures through the automatic relevance determination technique.
This functions delevers highly interpretable and sparse representations for
both signature profiles and attributions at a balance between data fitting and
model complexity (this method may introduce more signatures than expected,
especially for copy number signatures (thus <strong>I don't recommend you to use this feature
to extract copy number signatures</strong>)). See detail part and references for more.</p>
    </div>

    <pre class="usage"><span class='fu'>sig_auto_extract</span><span class='op'>(</span>
  nmf_matrix <span class='op'>=</span> <span class='cn'>NULL</span>,
  result_prefix <span class='op'>=</span> <span class='st'>"BayesNMF"</span>,
  destdir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"L1W.L2H"</span>, <span class='st'>"L1KL"</span>, <span class='st'>"L2KL"</span><span class='op'>)</span>,
  strategy <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"stable"</span>, <span class='st'>"optimal"</span>, <span class='st'>"ms"</span><span class='op'>)</span>,
  ref_sigs <span class='op'>=</span> <span class='cn'>NULL</span>,
  K0 <span class='op'>=</span> <span class='fl'>25</span>,
  nrun <span class='op'>=</span> <span class='fl'>10</span>,
  niter <span class='op'>=</span> <span class='fl'>2e+05</span>,
  tol <span class='op'>=</span> <span class='fl'>1e-07</span>,
  cores <span class='op'>=</span> <span class='fl'>1</span>,
  optimize <span class='op'>=</span> <span class='cn'>FALSE</span>,
  skip <span class='op'>=</span> <span class='cn'>FALSE</span>,
  recover <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>nmf_matrix</th>
      <td><p>a <code>matrix</code> used for NMF decomposition with rows indicate samples and columns indicate components.</p></td>
    </tr>
    <tr>
      <th>result_prefix</th>
      <td><p>prefix for result data files.</p></td>
    </tr>
    <tr>
      <th>destdir</th>
      <td><p>path to save data runs, default is <code><a href='https://rdrr.io/r/base/tempfile.html'>tempdir()</a></code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>default is "L1W.L2H", which uses an exponential prior for W and
a half-normal prior for H (This method is used by PCAWG project, see reference #3).
You can also use "L1KL" to set expoential priors for both W and H, and "L2KL" to
set half-normal priors for both W and H. The latter two methods are originally
implemented by <a href='https://software.broadinstitute.org/cancer/cga/msp'>SignatureAnalyzer software</a>.</p></td>
    </tr>
    <tr>
      <th>strategy</th>
      <td><p>the selection strategy for returned data. Set 'stable' for getting optimal
result from the most frequent K. Set 'optimal' for getting optimal result from all Ks.
Set 'ms' for getting result with maximum mean cosine similarity with provided reference
signatures. See <code>ref_sigs</code> option for details.
If you want select other solution, please check <a href='get_bayesian_result.html'>get_bayesian_result</a>.</p></td>
    </tr>
    <tr>
      <th>ref_sigs</th>
      <td><p>A Signature object or matrix or string for specifying
reference signatures, only used when <code>strategy = 'ms'</code>.
See <code>Signature</code> and <code>sig_db</code> options in <a href='get_sig_similarity.html'>get_sig_similarity</a> for details.</p></td>
    </tr>
    <tr>
      <th>K0</th>
      <td><p>number of initial signatures.</p></td>
    </tr>
    <tr>
      <th>nrun</th>
      <td><p>number of independent simulations.</p></td>
    </tr>
    <tr>
      <th>niter</th>
      <td><p>the maximum number of iterations.</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>tolerance for convergence.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>number of cpu cores to run NMF.</p></td>
    </tr>
    <tr>
      <th>optimize</th>
      <td><p>if <code>TRUE</code>, then refit the denovo signatures with QP method, see <a href='sig_fit.html'>sig_fit</a>.</p></td>
    </tr>
    <tr>
      <th>skip</th>
      <td><p>if <code>TRUE</code>, it will skip running a previous stored result. This can be used to
extend run times, e.g. you try running 10 times firstly and then you want to extend it to
20 times.</p></td>
    </tr>
    <tr>
      <th>recover</th>
      <td><p>if <code>TRUE</code>, try to recover result from previous runs based on input <code>result_prefix</code>,
<code>destdir</code> and <code>nrun</code>. This is pretty useful for reproducing result. Please use <code>skip</code> if you want
to recover an unfinished job.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a <code>list</code> with <code>Signature</code> class.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>There are three methods available in this function: "L1W.L2H", "L1KL" and "L2KL".
They use different priors for the bayesian variant of NMF algorithm
(see <code>method</code> parameter) written by reference #1 and implemented in
<a href='https://software.broadinstitute.org/cancer/cga/msp'>SignatureAnalyzer software</a>
(reference #2).</p>
<p>I copied source code for the three methods from Broad Institute and supplementary
files of reference #3, and wrote this higher function. It is more friendly for users
to extract, visualize and analyze signatures by combining with other powerful functions
in <strong>sigminer</strong> package. Besides, I implemented parallel computation to speed up
the calculation process and a similar input and output structure like <code><a href='sig_extract.html'>sig_extract()</a></code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Tan, Vincent YF, and Cédric Févotte. "Automatic relevance determination in nonnegative matrix factorization with the/spl beta/-divergence."
IEEE Transactions on Pattern Analysis and Machine Intelligence 35.7 (2012): 1592-1605.</p>
<p>Kim, Jaegil, et al. "Somatic ERCC2 mutations are associated with a distinct genomic signature in urothelial tumors."
Nature genetics 48.6 (2016): 600.</p>
<p>Alexandrov, Ludmil, et al. "The repertoire of mutational signatures in human cancer." BioRxiv (2018): 322859.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='sig_tally.html'>sig_tally</a> for getting variation matrix,
<a href='sig_extract.html'>sig_extract</a> for extracting signatures using <strong>NMF</strong> package, <a href='sig_estimate.html'>sig_estimate</a> for
estimating signature number for <a href='sig_extract.html'>sig_extract</a>.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Shixiang Wang</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"toy_copynumber_tally_W.RData"</span>,
  package <span class='op'>=</span> <span class='st'>"sigminer"</span>, mustWork <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span><span class='op'>)</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'>sig_auto_extract</span><span class='op'>(</span><span class='va'>cn_tally_W</span><span class='op'>$</span><span class='va'>nmf_matrix</span>, result_prefix <span class='op'>=</span> <span class='st'>"Test_copynumber"</span>, nrun <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='co'># At default, all run files are stored in tempdir()</span>
<span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>dir</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>, pattern <span class='op'>=</span> <span class='st'>"Test_copynumber"</span><span class='op'>)</span>
<span class='co'># \donttest{</span>
<span class='va'>laml.maf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"tcga_laml.maf.gz"</span>, package <span class='op'>=</span> <span class='st'>"maftools"</span><span class='op'>)</span>
<span class='va'>laml</span> <span class='op'>&lt;-</span> <span class='fu'><a href='read_maf.html'>read_maf</a></span><span class='op'>(</span>maf <span class='op'>=</span> <span class='va'>laml.maf</span><span class='op'>)</span>
<span class='va'>mt_tally</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sig_tally.html'>sig_tally</a></span><span class='op'>(</span>
  <span class='va'>laml</span>,
  ref_genome <span class='op'>=</span> <span class='st'>"BSgenome.Hsapiens.UCSC.hg19"</span>,
  use_syn <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>sig_auto_extract</span><span class='op'>(</span><span class='va'>mt_tally</span><span class='op'>$</span><span class='va'>nmf_matrix</span>,
  strategy <span class='op'>=</span> <span class='st'>"ms"</span>, nrun <span class='op'>=</span> <span class='fl'>3</span>, ref_sigs <span class='op'>=</span> <span class='st'>"legacy"</span>
<span class='op'>)</span>
<span class='va'>x</span>
<span class='co'># }</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://orcid.org/0000-0001-9855-7357'>Shixiang Wang</a>, Ziyu Tao, Huimin Li, Tao Wu, <a href='https://orcid.org/0000-0002-7736-0077'>Xue-Song Liu</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


